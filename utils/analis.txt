import numpy as np
from tensorflow.keras.models import load_model

# Load LSTM model
lstm_model = load_model("models/head_movement_lstm.h5")

# utils/analysis.py
def analyze_head_movement(head_positions):
    focus_count = head_positions.count("focus")
    distracted_count = head_positions.count("distracted")
    sleepy_count = head_positions.count("sleepy")
    not_detected_count = head_positions.count("not_detected")

    total_count = len(head_positions)
    if total_count == 0:
        return "No Data"

    # Weighted scoring for better accuracy
    focus_score = (focus_count / total_count) * 1.0
    distracted_score = (distracted_count / total_count) * 0.7
    sleepy_score = (sleepy_count / total_count) * 0.5

    if focus_score > distracted_score and focus_score > sleepy_score:
        return "High Focus"
    elif distracted_score > focus_score and distracted_score > sleepy_score:
        return "Distracted"
    elif sleepy_score > focus_score and sleepy_score > distracted_score:
        return "Sleepy"
    else:
        return "Mixed Results"
